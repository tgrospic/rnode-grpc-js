<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@tgrospic/rnode-grpc-js</title><meta name="description" content="Documentation for @tgrospic/rnode-grpc-js"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@tgrospic/rnode-grpc-js</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@tgrospic/rnode-grpc-js</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#rnode-grpc-api-generator" id="rnode-grpc-api-generator" style="color: inherit; text-decoration: none;">
  <h1>RNode gRPC API generator</h1>
</a>
<p>This library helps to generate <strong>JavaScript</strong> bindings for <strong>RNode gRPC API</strong>.</p>
<p>Examples of how to use it with <strong>Nodejs</strong> and in the <strong>browser</strong> are in <a href="https://github.com/tgrospic/rnode-client-js">@tgrospic/rnode-client-js</a> repository.</p>
<p>RNode also exposes <strong>HTTP</strong> natively with <strong>RNode Web API</strong>, for more information see <a href="https://github.com/tgrospic/rnode-http-js">@tgrospic/rnode-http-js</a>.</p>
<p><strong>Deploys sent via Web API still have to be serialized with protobuf, but it&#39;s not necessary to use this library and generate any JS code. <a href="src/rnode-sign.ts">rnode-sign.ts</a> can be used independently in your web project.</strong></p>
<p><em>gRPC is not supported in the browser but it can be used with the proxy. Here is the example of <a href="https://github.com/grpc/grpc-web/blob/952d0f5869b315039a994011ecb5bf57dfdea999/net/grpc/gateway/examples/helloworld/envoy.yaml">Envoy configuration</a> to run your own <em>HTTP/gRPC</em> proxy.</em></p>

<a href="#it-contains-two-parts" id="it-contains-two-parts" style="color: inherit; text-decoration: none;">
  <h4>It contains two parts:</h4>
</a>
<ul>
<li><code>rnode-grpc</code> CLI to generate JS files with <strong>TypeScript definitions</strong></li>
<li>helper functions to create <strong>JS client</strong> with <strong>Promise</strong> based <strong>RNode</strong> service methods.</li>
</ul>

<a href="#install" id="install" style="color: inherit; text-decoration: none;">
  <h2>Install</h2>
</a>
<pre><code class="language-sh"><span class="hl-1">npm install @tgrospic/rnode-grpc-js</span><br/><br/><span class="hl-4"># gRPC and protobuf for use with Nodejs</span><br/><span class="hl-4"># - compatible with native `grpc` package</span><br/><span class="hl-1">npm install google-protobuf @grpc/grpc-js</span><br/><span class="hl-4"># Or for use in the browser (via Envoy proxy)</span><br/><span class="hl-1">npm install google-protobuf grpc-web</span><br/><br/><span class="hl-4"># For crypto operations (create private key)</span><br/><span class="hl-1">npm install elliptic</span>
</code></pre>
<p>Install peer dependencies needed to generate JS files from proto definitions.</p>
<pre><code class="language-sh"><span class="hl-1">npm install --save-dev grpc-tools protobufjs</span>
</code></pre>

<a href="#generate-js-files" id="generate-js-files" style="color: inherit; text-decoration: none;">
  <h2>Generate JS files</h2>
</a>
<p>The purpose of <code>rnode-grpc</code> CLI command is to download and generate necessary files.</p>
<pre><code class="language-sh"><span class="hl-4"># Generate all files with default options (run from your package.json scripts)</span><br/><span class="hl-1">rnode-grpc</span><br/><br/><span class="hl-4"># Generate with specific options</span><br/><span class="hl-1">rnode-grpc --rnode-version v0.12.4 --gen-dir ./rnode-grpc-gen</span><br/><br/><span class="hl-4"># Run from your project folder</span><br/><span class="hl-1">node_modules/.bin/rnode-grpc</span>
</code></pre>

<a href="#cli-options" id="cli-options" style="color: inherit; text-decoration: none;">
  <h2>CLI options</h2>
</a>
<table>
<thead>
<tr>
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>--rnode-version</td>
<td><code>v0.12.4</code></td>
<td>Version (repo tag) of RNode to generate API.</td>
</tr>
<tr>
<td>--gen-dir</td>
<td><code>./rnode-grpc-gen</code></td>
<td>Path to output directory.</td>
</tr>
</tbody></table>
<details>
<summary>Additional use for RNode version option</summary>

<p>We can generate API from not yet published RNode version. From any branch on <a href="https://github.com/rchain/rchain">rchain/rchain</a> repo, e.g. <code>dev</code> branch.</p>
<pre><code class="language-sh"><span class="hl-1">rnode-grpc --rnode-version dev</span>
</code></pre>
<p>And make requests to new <em>DeployService</em> method <code>isFinalized</code>. :smile:</p>
<pre><code class="language-typescript"><span class="hl-0">interface</span><span class="hl-1"> </span><span class="hl-8">DeployService</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">// Not yet available in v0.9.12 RNode</span><br/><span class="hl-1">  </span><span class="hl-6">isFinalized</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">IsFinalizedQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">IsFinalizedResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-4">// ...existing methods</span><br/><span class="hl-1">}</span>
</code></pre>
</details>


<a href="#api" id="api" style="color: inherit; text-decoration: none;">
  <h2>API</h2>
</a>
<p>Complete API is combined from the part provided by the library and the generated part for a specific version of RNode.</p>
<p>Documentation for library part can be found here <a href="https://tgrospic.github.io/rnode-grpc-js/">https://tgrospic.github.io/rnode-grpc-js/</a> and generated part with TypeScript definitions can be found in a directory specified by <code>--gen-dir</code> option.</p>
<p>More info for client options for <a href="https://github.com/grpc/grpc-node/blob/b05caec/packages/grpc-js/src/client.ts#L67">@grpc/grpc-js</a> and <a href="https://github.com/grpc/grpc-web/blob/8b501a96f/javascript/net/grpc/web/grpcwebclientbase.js#L45">grpc-web</a>.</p>
<pre><code class="language-typescript"><span class="hl-0">interface</span><span class="hl-1"> </span><span class="hl-8">Options</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">// gRPC protocol implementation</span><br/><span class="hl-1">  </span><span class="hl-4">// - `@grpc/grpc-js` for Nodejs</span><br/><span class="hl-1">  </span><span class="hl-4">// - `grpc-web` for browser</span><br/><span class="hl-1">  </span><span class="hl-7">grpcLib</span><span class="hl-1">: </span><span class="hl-8">any</span><br/><span class="hl-1">  </span><span class="hl-4">// Custom options for gRPC clients</span><br/><span class="hl-1">  </span><span class="hl-4">// - `credentials` can be supplied as part of `clientOptions` for `grpc-js`</span><br/><span class="hl-1">  </span><span class="hl-7">clientOptions</span><span class="hl-1">?: </span><span class="hl-8">any</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">// RNode host (method prefix)</span><br/><span class="hl-1">  </span><span class="hl-7">host</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">// Generated JSON schema</span><br/><span class="hl-1">  </span><span class="hl-7">protoSchema</span><span class="hl-1">: </span><span class="hl-8">Object</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// Get deploy service methods</span><br/><span class="hl-6">rnodeDeploy</span><span class="hl-1">(</span><span class="hl-7">opt</span><span class="hl-1">: </span><span class="hl-7">Options</span><span class="hl-1">): </span><span class="hl-7">DeployService</span><br/><br/><span class="hl-4">// Get propose service methods</span><br/><span class="hl-6">rnodePropose</span><span class="hl-1">(</span><span class="hl-7">opt</span><span class="hl-1">: </span><span class="hl-7">Options</span><span class="hl-1">): </span><span class="hl-7">ProposeService</span><br/><br/><span class="hl-4">// Get repl service methods</span><br/><span class="hl-6">rnodeRepl</span><span class="hl-1">(</span><span class="hl-7">opt</span><span class="hl-1">: </span><span class="hl-7">Options</span><span class="hl-1">): </span><span class="hl-7">Repl</span><br/><br/><span class="hl-4">// Get all service methods</span><br/><span class="hl-6">rnodeService</span><span class="hl-1">(</span><span class="hl-7">opt</span><span class="hl-1">: </span><span class="hl-7">Options</span><span class="hl-1">): </span><span class="hl-7">DeployService</span><span class="hl-1"> &amp; </span><span class="hl-7">ProposeService</span><span class="hl-1"> &amp; </span><span class="hl-7">Repl</span><br/><br/><span class="hl-4">// Sign deploy data</span><br/><span class="hl-6">signDeploy</span><span class="hl-1">(</span><span class="hl-7">key</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1"> | </span><span class="hl-8">Uint8Array</span><span class="hl-1"> | </span><span class="hl-7">Buffer</span><span class="hl-1"> | </span><span class="hl-7">ec</span><span class="hl-1">.</span><span class="hl-7">KeyPair</span><span class="hl-1">, </span><span class="hl-7">deploy</span><span class="hl-1">: </span><span class="hl-7">UnsignedDeployData</span><span class="hl-1">): </span><span class="hl-7">DeployDataProto</span><br/><br/><span class="hl-4">// Verify deploy signature</span><br/><span class="hl-6">verifyDeploy</span><span class="hl-1">(</span><span class="hl-7">deploy</span><span class="hl-1">: </span><span class="hl-7">DeployDataProto</span><span class="hl-1">): </span><span class="hl-8">Boolean</span><br/><br/><span class="hl-4">// Protobuf serialize / deserialize operations</span><br/><span class="hl-6">rnodeProtobuf</span><span class="hl-1">({</span><span class="hl-7">protoSchema</span><span class="hl-1">}): </span><span class="hl-7">TypesBinary</span><br/><br/><span class="hl-4">// Transform Par type to JSON (with meaningful defaults)</span><br/><span class="hl-6">rhoParToJson</span><span class="hl-1">(</span><span class="hl-7">input</span><span class="hl-1">: </span><span class="hl-7">Par</span><span class="hl-1">): </span><span class="hl-7">any</span>
</code></pre>

<a href="#typescript-definitions" id="typescript-definitions" style="color: inherit; text-decoration: none;">
  <h3>TypeScript definitions</h3>
</a>
<p>Here is an example of <a href="docs/rnode-grpc-js-v0.12.4.d.ts">TypeScript definition file</a> generated for <code>v0.12.4</code> version of RNode.</p>
<pre><code class="language-sh"><span class="hl-4"># Run CLI command with an option to specify RNode version (Git repo release tag)</span><br/><span class="hl-1">rnode-grpc --rnode-version v0.12.4</span>
</code></pre>
<p><em>Generated TypeScript definitions are complete with the conversion of response errors inside the message to <code>Promise</code> errors. For RNode after <code>v0.9.14</code> version <code>ServiceError</code> type is converted and on previous versions the same conversion is done on a <em>dynamic</em> <code>Either</code> type.</em> :smile:</p>
<pre><code class="language-typescript"><span class="hl-4">// Typescipt generated interface from RNode v0.12.4 protbuf definitions</span><br/><span class="hl-0">interface</span><span class="hl-1"> </span><span class="hl-8">DeployService</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">doDeploy</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">DeployDataProto</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">DeployResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">getBlock</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">BlockQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">BlockResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">visualizeDag</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">VisualizeDagQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">VisualizeBlocksResponse</span><span class="hl-1">[]&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">machineVerifiableDag</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">MachineVerifyQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">MachineVerifyResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">showMainChain</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">BlocksQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">BlockInfoResponse</span><span class="hl-1">[]&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">getBlocks</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">BlocksQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">BlockInfoResponse</span><span class="hl-1">[]&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">listenForDataAtName</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">: </span><span class="hl-8">DataAtNameQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">ListeningNameDataResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">listenForContinuationAtName</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">: </span><span class="hl-8">ContinuationAtNameQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">ContinuationAtNameResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">findDeploy</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">FindDeployQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">FindDeployResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">previewPrivateNames</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">PrivateNamePreviewQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">PrivateNamePreviewResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">lastFinalizedBlock</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">LastFinalizedBlockQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">LastFinalizedBlockResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">isFinalized</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">IsFinalizedQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">IsFinalizedResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">bondStatus</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">BondStatusQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">BondStatusResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">exploratoryDeploy</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">ExploratoryDeployQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">ExploratoryDeployResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">getBlocksByHeights</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">BlocksQueryByHeight</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">BlockInfoResponse</span><span class="hl-1">[]&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">getEventByHash</span><span class="hl-1">(</span><span class="hl-7">_</span><span class="hl-1">?: </span><span class="hl-8">ReportQuery</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">EventInfoResponse</span><span class="hl-1">&gt;</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#sample-code-for-grpc-requests-to-rnode" id="sample-code-for-grpc-requests-to-rnode" style="color: inherit; text-decoration: none;">
  <h2>Sample code for gRPC requests to RNode</h2>
</a>
<p><em>NOTE: RNode also exposes <strong>HTTP</strong> natively with <strong>RNode Web API</strong>, for more information see <a href="https://github.com/tgrospic/rnode-http-js">@tgrospic/rnode-http-js</a>.</em></p>
<p>Using gRPC in the browser is not supported but it&#39;s possible with gRPC-HTTP proxy and <a href="https://github.com/grpc/grpc-web">grpc-web</a> library.</p>
<p>Working version of these examples can be found in <a href="https://github.com/tgrospic/rnode-client-js/tree/master/src/nodejs">@tgrospic/rnode-client-js/src/nodejs</a>.</p>
<pre><code class="language-typescript"><span class="hl-4">/// </span><span class="hl-10">&lt;</span><span class="hl-11">reference</span><span class="hl-4"> </span><span class="hl-12">path</span><span class="hl-1">=</span><span class="hl-3">&quot;../rnode-grpc-gen/js/rnode-grpc-js.d.ts&quot;</span><span class="hl-4"> </span><span class="hl-10">/&gt;</span><br/><span class="hl-2">import</span><span class="hl-1"> </span><span class="hl-7">grpcLib</span><span class="hl-1"> </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@grpc/grpc-js&#39;</span><br/><span class="hl-4">// import grpcLib from &#39;grpc-web&#39; // when using gRPC-HTTP proxy</span><br/><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-7">ec</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&#39;elliptic&#39;</span><br/><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-7">rnodeDeploy</span><span class="hl-1">, </span><span class="hl-7">rnodePropose</span><span class="hl-1">, </span><span class="hl-7">signDeploy</span><span class="hl-1">, </span><span class="hl-7">verifyDeploy</span><span class="hl-1">, </span><span class="hl-7">LightBlockInfo</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@tgrospic/rnode-grpc-js&#39;</span><br/><br/><span class="hl-4">// Generated files with rnode-grpc-js tool</span><br/><span class="hl-2">import</span><span class="hl-1"> </span><span class="hl-7">protoSchema</span><span class="hl-1"> </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&#39;../rnode-grpc-gen/js/pbjs_generated.json&#39;</span><br/><span class="hl-4">// Import generated protobuf types (in global scope)</span><br/><span class="hl-2">import</span><span class="hl-1"> </span><span class="hl-3">&#39;../rnode-grpc-gen/js/DeployServiceV1_pb&#39;</span><br/><span class="hl-2">import</span><span class="hl-1"> </span><span class="hl-3">&#39;../rnode-grpc-gen/js/ProposeServiceV1_pb&#39;</span><br/><br/><span class="hl-4">// RNode validator address (or any read-only RNode if we don&#39;t use _deploy_ and _propose_)</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">rnodeExternalUrl</span><span class="hl-1"> = </span><span class="hl-3">&#39;node2.testnet.rchain.coop:40401&#39;</span><br/><span class="hl-4">// const rnodeInternalUrl = &#39;localhost:40402&#39;</span><br/><span class="hl-4">// const rnodeExternalUrl = &#39;https://&lt;host&gt;:&lt;port&gt;&#39; // when using gRPC-HTTP proxy</span><br/><br/><span class="hl-4">// gRPC client options</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">options</span><span class="hl-1"> = { </span><span class="hl-7">grpcLib:</span><span class="hl-1"> </span><span class="hl-7">grpcLib</span><span class="hl-1">, </span><span class="hl-7">host:</span><span class="hl-1"> </span><span class="hl-7">rnodeExternalUrl</span><span class="hl-1">, </span><span class="hl-7">protoSchema</span><span class="hl-1"> }</span><br/><br/><span class="hl-4">// Get RNode service methods</span><br/><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-5">getBlocks</span><span class="hl-1">, </span><span class="hl-5">DoDeploy</span><span class="hl-1"> } = </span><span class="hl-6">rnodeDeploy</span><span class="hl-1">(</span><span class="hl-7">options</span><span class="hl-1">)</span><br/><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-5">propose</span><span class="hl-1"> }             = </span><span class="hl-6">rnodePropose</span><span class="hl-1">(</span><span class="hl-7">options</span><span class="hl-1">)</span><br/><br/><span class="hl-4">// Get blocks from RNode</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">blocks</span><span class="hl-1">: </span><span class="hl-8">LightBlockInfo</span><span class="hl-1">[] = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">getBlocks</span><span class="hl-1">({ </span><span class="hl-7">depth:</span><span class="hl-1"> </span><span class="hl-9">2</span><span class="hl-1"> })</span><br/><br/><span class="hl-4">// Generate sample KeyPair (private/public keys) to sign the deploy</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">secp256k1</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-6">ec</span><span class="hl-1">(</span><span class="hl-3">&#39;secp256k1&#39;</span><span class="hl-1">)</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">key</span><span class="hl-1"> = </span><span class="hl-7">secp256k1</span><span class="hl-1">.</span><span class="hl-6">genKeyPair</span><span class="hl-1">()</span><br/><span class="hl-4">// Or use existing as hex string or Uint8Array</span><br/><span class="hl-4">// const key = &#39;1bf36a3d89c27ddef7955684b97667c75454317d8964528e57b2308947b250b0&#39;</span><br/><br/><span class="hl-4">// Sample Rholang code we want to deploy</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">deployData</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-7">term:</span><span class="hl-1"> </span><span class="hl-3">&#39;new out(`rho:io:stdout`) in { out!(&quot;Browser deploy test&quot;) }&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">timestamp:</span><span class="hl-1"> </span><span class="hl-8">Date</span><span class="hl-1">.</span><span class="hl-6">now</span><span class="hl-1">(),      </span><span class="hl-4">// nonce</span><br/><span class="hl-1">  </span><span class="hl-7">phloprice:</span><span class="hl-1"> </span><span class="hl-9">1</span><span class="hl-1">,               </span><span class="hl-4">// price of tinny REV for phlogiston (gas)</span><br/><span class="hl-1">  </span><span class="hl-7">phlolimit:</span><span class="hl-1"> </span><span class="hl-9">10e3</span><span class="hl-1">,            </span><span class="hl-4">// max phlogiston (gas) for deploy execution</span><br/><span class="hl-1">  </span><span class="hl-7">validafterblocknumber:</span><span class="hl-1"> </span><span class="hl-9">123</span><span class="hl-1">, </span><span class="hl-4">// latest block number</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// Helper function to sign a deploy</span><br/><span class="hl-4">// - this can be done when offline and save the signed deploy as JSON</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">deploy</span><span class="hl-1"> = </span><span class="hl-6">signDeploy</span><span class="hl-1">(</span><span class="hl-7">key</span><span class="hl-1">, </span><span class="hl-7">deployData</span><span class="hl-1">)</span><br/><br/><span class="hl-4">// and to check the signature</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">isValidDeploy</span><span class="hl-1"> = </span><span class="hl-6">verifyDeploy</span><span class="hl-1">(</span><span class="hl-7">deploy</span><span class="hl-1">)</span><br/><br/><span class="hl-4">// Send signed deploy to RNode</span><br/><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-5">message</span><span class="hl-1"> } = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">DoDeploy</span><span class="hl-1">(</span><span class="hl-7">deploy</span><span class="hl-1">)</span><br/><br/><span class="hl-4">// Propose deploys to the rest of the network</span><br/><span class="hl-4">// - this is done by the validator and allowed only on internal (private) port</span><br/><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">propose</span><span class="hl-1">()</span><br/><br/><span class="hl-4">// Get result from deploy (after deploy is added to a block)</span><br/><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-7">payload</span><span class="hl-1">: { </span><span class="hl-5">blockinfoList</span><span class="hl-1"> } } = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">listenForDataAtName</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-7">depth:</span><span class="hl-1"> </span><span class="hl-9">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">name:</span><span class="hl-1"> { </span><span class="hl-7">unforgeablesList:</span><span class="hl-1"> [{</span><span class="hl-7">gDeployIdBody:</span><span class="hl-1"> { </span><span class="hl-7">sig:</span><span class="hl-1"> </span><span class="hl-7">deploy</span><span class="hl-1">.</span><span class="hl-7">sig</span><span class="hl-1"> }}] },</span><br/><span class="hl-1">})</span>
</code></pre>

<a href="#protobuf-serialize-and-deserialize-operations" id="protobuf-serialize-and-deserialize-operations" style="color: inherit; text-decoration: none;">
  <h3>Protobuf serialize and deserialize operations</h3>
</a>
<p>The small wrapper <code>rnodeProtobuf</code> allows easier access to protobuf generated types and serialize/deserialize operations.</p>
<pre><code class="language-typescript"><span class="hl-4">/// </span><span class="hl-10">&lt;</span><span class="hl-11">reference</span><span class="hl-4"> </span><span class="hl-12">path</span><span class="hl-1">=</span><span class="hl-3">&quot;../rnode-grpc-gen/js/rnode-grpc-js.d.ts&quot;</span><span class="hl-4"> </span><span class="hl-10">/&gt;</span><br/><span class="hl-4">// Generated protobuf files must be loaded to instantiate a global proto object</span><br/><span class="hl-4">// needed for `rnodeProtobuf`</span><br/><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&#39;../rnode-grpc-gen/js/DeployServiceV1_pb&#39;</span><span class="hl-1">)</span><br/><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&#39;../rnode-grpc-gen/js/ProposeServiceV1_pb&#39;</span><span class="hl-1">)</span><br/><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&#39;../rnode-grpc-gen/js/repl_pb&#39;</span><span class="hl-1">)</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">protoSchema</span><span class="hl-1"> = </span><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&#39;../rnode-grpc-gen/js/pbjs_generated.json&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-5">rnodeProtobuf</span><span class="hl-1"> } = </span><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&#39;@tgrospic/rnode-grpc-js&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-4">// Get types with serialize and deserialize operations</span><br/><span class="hl-0">const</span><span class="hl-1"> { </span><span class="hl-5">DeployDataProto</span><span class="hl-1">, </span><span class="hl-5">CmdRequest</span><span class="hl-1"> } = </span><span class="hl-6">rnodeProtobuf</span><span class="hl-1">({ </span><span class="hl-7">protoSchema</span><span class="hl-1"> })</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">deployBytes</span><span class="hl-1"> = </span><span class="hl-7">DeployDataProto</span><span class="hl-1">.</span><span class="hl-6">serialize</span><span class="hl-1">({ </span><span class="hl-7">term:</span><span class="hl-1"> </span><span class="hl-3">&#39;Nil&#39;</span><span class="hl-1">, </span><span class="hl-7">phlolimit:</span><span class="hl-1"> </span><span class="hl-9">1000</span><span class="hl-1"> })</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">deployObj</span><span class="hl-1">: </span><span class="hl-8">DeployDataProto</span><span class="hl-1"> = </span><span class="hl-7">DeployDataProto</span><span class="hl-1">.</span><span class="hl-6">deserialize</span><span class="hl-1">(</span><span class="hl-7">deployBytes</span><span class="hl-1">)</span>
</code></pre>

<a href="#what-is-the-difference-with-rchain-api" id="what-is-the-difference-with-rchain-api" style="color: inherit; text-decoration: none;">
  <h2>What is the difference with RChain-API?</h2>
</a>
<p>The main difference is that this library does not depend on any specific version of RNode nor the schema definition (with minor caveats). RNode version is an input parameter and the goal is to generate JS and TS code for any RNode version.</p>

<a href="#example-for-nodejs-with-web" id="example-for-nodejs-with-web" style="color: inherit; text-decoration: none;">
  <h2>Example for Node.js (with web)</h2>
</a>
<p>Sample static site to test requests from the browser
<a href="https://tgrospic.github.io/rnode-client-js">https://tgrospic.github.io/rnode-client-js</a>. It&#39;s published as part of the example repository <a href="https://github.com/tgrospic/rnode-client-js">@tgrospic/rnode-client-js</a>. It also contains protobuf/gRPC examples for Node.js.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/BinaryOp.html" class="tsd-kind-icon">Binary<wbr/>Op</a></li><li class="tsd-kind-interface"><a href="interfaces/DeploySignedProto.html" class="tsd-kind-icon">Deploy<wbr/>Signed<wbr/>Proto</a></li><li class="tsd-kind-interface"><a href="interfaces/EList.html" class="tsd-kind-icon">EList</a></li><li class="tsd-kind-interface"><a href="interfaces/EMap.html" class="tsd-kind-icon">EMap</a></li><li class="tsd-kind-interface"><a href="interfaces/ESet.html" class="tsd-kind-icon">ESet</a></li><li class="tsd-kind-interface"><a href="interfaces/ETuple.html" class="tsd-kind-icon">ETuple</a></li><li class="tsd-kind-interface"><a href="interfaces/Expr.html" class="tsd-kind-icon">Expr</a></li><li class="tsd-kind-interface"><a href="interfaces/GDeployId.html" class="tsd-kind-icon">GDeploy<wbr/>Id</a></li><li class="tsd-kind-interface"><a href="interfaces/GDeployerId.html" class="tsd-kind-icon">GDeployer<wbr/>Id</a></li><li class="tsd-kind-interface"><a href="interfaces/GPrivate.html" class="tsd-kind-icon">GPrivate</a></li><li class="tsd-kind-interface"><a href="interfaces/GUnforgeable.html" class="tsd-kind-icon">GUnforgeable</a></li><li class="tsd-kind-interface"><a href="interfaces/KeyValuePair.html" class="tsd-kind-icon">Key<wbr/>Value<wbr/>Pair</a></li><li class="tsd-kind-interface"><a href="interfaces/Options.html" class="tsd-kind-icon">Options</a></li><li class="tsd-kind-interface"><a href="interfaces/Par.html" class="tsd-kind-icon">Par</a></li><li class="tsd-kind-interface"><a href="interfaces/RevAddress.html" class="tsd-kind-icon">Rev<wbr/>Address</a></li><li class="tsd-kind-interface"><a href="interfaces/Unit.html" class="tsd-kind-icon">Unit</a></li><li class="tsd-kind-interface"><a href="interfaces/UnsignedDeployData.html" class="tsd-kind-icon">Unsigned<wbr/>Deploy<wbr/>Data</a></li><li class="tsd-kind-interface"><a href="interfaces/WildcardMsg.html" class="tsd-kind-icon">Wildcard<wbr/>Msg</a></li><li class="tsd-kind-function"><a href="modules.html#deployDataProtobufSerialize" class="tsd-kind-icon">deploy<wbr/>Data<wbr/>Protobuf<wbr/>Serialize</a></li><li class="tsd-kind-function"><a href="modules.html#getAddrFromEth" class="tsd-kind-icon">get<wbr/>Addr<wbr/>From<wbr/>Eth</a></li><li class="tsd-kind-function"><a href="modules.html#getAddrFromPrivateKey" class="tsd-kind-icon">get<wbr/>Addr<wbr/>From<wbr/>Private<wbr/>Key</a></li><li class="tsd-kind-function"><a href="modules.html#getAddrFromPublicKey" class="tsd-kind-icon">get<wbr/>Addr<wbr/>From<wbr/>Public<wbr/>Key</a></li><li class="tsd-kind-function"><a href="modules.html#newRevAddress" class="tsd-kind-icon">new<wbr/>Rev<wbr/>Address</a></li><li class="tsd-kind-function"><a href="modules.html#parseRevAddress" class="tsd-kind-icon">parse<wbr/>Rev<wbr/>Address</a></li><li class="tsd-kind-function"><a href="modules.html#rhoParToJson" class="tsd-kind-icon">rho<wbr/>Par<wbr/>To<wbr/>Json</a></li><li class="tsd-kind-function"><a href="modules.html#signDeploy" class="tsd-kind-icon">sign<wbr/>Deploy</a></li><li class="tsd-kind-function"><a href="modules.html#verifyDeploy" class="tsd-kind-icon">verify<wbr/>Deploy</a></li><li class="tsd-kind-function"><a href="modules.html#verifyRevAddr" class="tsd-kind-icon">verify<wbr/>Rev<wbr/>Addr</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>